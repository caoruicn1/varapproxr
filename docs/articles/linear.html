<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Linear Models • varapproxr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Linear Models">
<meta property="og:description" content="varapproxr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">varapproxr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/varapproxr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/examples.html">`varapproxr` Examples</a>
    </li>
    <li>
      <a href="../articles/linear.html">Linear Models</a>
    </li>
    <li>
      <a href="../articles/web_only/basics.html">Basics of Variational Approximations</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Linear Models</h1>
                        <h4 class="author">James Totterdell</h4>
            
            <h4 class="date">2020-05-26</h4>
      
      
      <div class="hidden name"><code>linear.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">varapproxr</span>)</pre></body></html></div>
<div id="normal-linear-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#normal-linear-regression" class="anchor"></a>Normal Linear Regression</h1>
<p>We consider the following model <span class="math display">\[
\begin{aligned}
p(y|\beta,\sigma^2) &amp;= \text{Normal}(y|X\beta, \Sigma) \\
p(\beta) &amp;= \text{Normal}(\beta|\mu_0, \Sigma_0) \\
\Sigma &amp;= \sigma^2 I_N
\end{aligned}
\]</span> with either <span class="math inline">\(p(\sigma^2) = \text{Inverse-Gamma}(\sigma^2|a_0, b_0)\)</span> or <span class="math inline">\(p(\sigma) = \text{Half-}t(\sigma^2|a_0,b_0)\)</span>. The latter can be expressed as <span class="math display">\[
\begin{aligned}
p(\sigma^2|\lambda) &amp;= \text{Inverse-Gamma}(b_0/2, b_0/\lambda) \\
p(\lambda) &amp;= \text{Inverse-Gamma}(1/2,1/a_0^2) \\
\implies p(\sigma) &amp;= \text{Half-}t(a_0,b_0)
\end{aligned}
\]</span></p>
<div id="inverse-gamma-prior-on-sigma2" class="section level2">
<h2 class="hasAnchor">
<a href="#inverse-gamma-prior-on-sigma2" class="anchor"></a>Inverse-Gamma prior on <span class="math inline">\(\sigma^2\)</span>
</h2>
<p>The joint posterior density <span class="math inline">\(p(\beta,\sigma^2,\lambda|y)\)</span> is approximated by <span class="math display">\[
q(\beta,\sigma^2,\lambda) = q(\beta)q(\sigma^2)
\]</span> with optimal solutions <span class="math display">\[
\begin{aligned}
q^\star(\beta) \propto \exp\left\{\mathbb E_{\sigma^2}\left[\ln p(\beta|y,\sigma^2)\right]\right\} \\
q^\star(\sigma^2) \propto \exp\left\{\mathbb E_{\beta}\left[\ln p(\sigma^2|y,\beta)\right]\right\}.
\end{aligned}
\]</span></p>
<p>From the model above, <span class="math inline">\(\ln p(y,\beta,\sigma^2) = \ln p(y|\beta,\sigma^2) + \ln p(\beta) + \ln p(\sigma^2|\lambda) + \ln p(\lambda)\)</span>. For the regression coefficients, the full conditional is <span class="math display">\[
\begin{aligned}
\ln p(\beta | y, \sigma^2) &amp;= \text{const} - \frac{1}{2}\left[(y-X\beta)^\top\Sigma^{-1}(y-X\beta) - \frac{1}{2}(\beta-\mu_0)^\top\Sigma_0^{-1}(\beta-\mu_0)\right] \\
&amp;= \text{const} - \frac{1}{2}\left[\left(\beta - M^{-1}m\right)^\top M\left(\beta - M^{-1}m\right)\right]\\
M &amp;= X^\top\Sigma^{-1}X + \Sigma_0^{-1} \\
m &amp;= X^\top\Sigma^{-1}y + \Sigma_0^{-1}\mu_0 \\
\implies p(\beta|y,\sigma^2) &amp;= \text{Normal}(\mu_{\beta|y,\sigma^2}, \Sigma_{\beta|y,\sigma^2}) \\
\Sigma_{\beta|y,\sigma^2} &amp;= \left(X^\top\Sigma^{-1}X + \Sigma_0^{-1}\right)^{-1} \\
\mu_{\beta|y,\sigma^2} &amp;= \Sigma_{\beta|y,\sigma^2}\left(X^\top\Sigma^{-1}y + \Sigma_0^{-1}\mu_0\right).
\end{aligned}
\]</span> From which, the optimal density is <span class="math display">\[
\begin{aligned}
\mathbb E_{q(\sigma^2)}[\ln p(\beta|y,\sigma^2)] &amp;= \text{const} - \frac{1}{2}\left[\left(\beta - M_q^{-1}m_q\right)^\top M_q\left(\beta - M_q^{-1}m_q\right)\right] \\
M_q &amp;= \mathbb E_{q(\sigma^2)}\left[\sigma^{-2}\right]X^\top X + \Sigma_0^{-1} \\
m_q &amp;= \mathbb E_{q(\sigma^2)}\left[\sigma^{-2}\right] X^\top y + \Sigma_0^{-1}\mu_0 \\
\implies q^\star(\beta) &amp;= \text{Normal}(\mu_{q(\beta)}, \Sigma_{q(\beta)}) \\
\Sigma_{q(\beta)} &amp;= \left(\mathbb E_{q(\sigma^2)}\left[\sigma^{-2}\right] X^\top X + \Sigma_0^{-1}\right)^{-1} \\
\mu_{q(\beta)} &amp;= \Sigma_{q(\beta)}\left(\mathbb E_{q(\sigma^2)}\left[\sigma^{-2}\right] X^\top y + \Sigma_0^{-1}\mu_0\right).
\end{aligned}
\]</span></p>
<p>For the variance component, <span class="math display">\[
\begin{aligned}
\ln p(\sigma^2|y,\beta) &amp;= \text{const} + \frac{P}{2}\ln(\sigma^{2})-\frac{1}{2}\sigma^{-2}\left[(y-X\beta)^\top(y-X\beta)\right] - (a_0+1)\ln(\sigma^2) - \sigma^{-2}b_0\\
\implies p(\sigma^2|y,\beta) &amp;= \text{Inverse-Gamma}(\sigma^2|a_{\sigma^2|\beta,y}, b_{\sigma^2|\beta,y}) \\
a_{\sigma^2|\beta,y} &amp;= a_0 + \frac{N}{2} \\
b_{\sigma^2|\beta,y} &amp;= b_0 + \frac{\lVert y-X\beta\rVert^2}{2}
\end{aligned}
\]</span> From which, the optimal density is <span class="math display">\[
\begin{aligned}
q^\star(\sigma^2) &amp;\propto \mathbb E_{q(\beta)}\left[\ln p(\sigma^2|y,\beta)\right] \\
\implies q^\star(\sigma^2) &amp;= \text{Inverse-Gamma}(a_{q(\sigma^2)}, b_{q(\sigma^2)}) \\
a_{q(\sigma^2)} &amp;= a_0 + \frac{N}{2} \\
b_{q(\sigma^2)} &amp;= b_0 + \frac{\lVert y - X\mu_{q(\beta)}\rVert^2+\text{tr}(X^\top X\Sigma_{q(\beta)})}{2}
\end{aligned}
\]</span> implying that <span class="math display">\[
\mathbb E_{q(\sigma^2)}\left[\sigma^{-2}\right] = \frac{a_{q(\sigma^2)}}{b_{q(\sigma^2)}}
\]</span> in the variational parameters for <span class="math inline">\(q^\star(\beta)\)</span>.</p>
<p>The lower bound itself is given by <span class="math display">\[
\begin{aligned}
\mathcal{L}(q) &amp;= \mathbb E_q[\ln p(y,\beta,\sigma^2) - q(\beta,\sigma^2)] \\ 
&amp;= \mathbb E_q[\ln p(y|\beta,\sigma^2)] + \mathbb E_q[\ln p(\beta)] + \mathbb E_q[\ln p(\sigma^2)] + 
\mathbb H_q[\beta] + \mathbb H_q[\sigma^2] \\
&amp;= 
\end{aligned}
\]</span></p>
<p>The updates are then <span class="math display">\[
\begin{aligned}
a_{q(\sigma^2)} &amp;\leftarrow a_0 + N/2 \\
\text{Cycle:} \\
  \Sigma_{q(\beta)} &amp;\leftarrow  \left(\frac{a_{q(\sigma^2)}}{b_{q(\sigma^2)}}X^\top X + \Sigma_0^{-1}\right)^{-1} \\
  \mu_{q(\beta)} &amp;\leftarrow \Sigma_{q(\beta)}\left(\frac{a_{q(\sigma^2)}}{b_{q(\sigma^2)}} X^\top y + \Sigma_0^{-1}\mu_0\right) \\
  b_{q(\sigma^2)} &amp;\leftarrow b_0 + \frac{\lVert y - X\mu_{q(\beta)}\rVert^2+\text{tr}(X^\top X\Sigma_{q(\beta)})}{2}
\end{aligned}
\]</span> until the change in <span class="math inline">\(\mathcal{L}(q)\)</span> is below a specified tolerance level indicating convergence.</p>
</div>
<div id="half-t-prior-on-sigma" class="section level2">
<h2 class="hasAnchor">
<a href="#half-t-prior-on-sigma" class="anchor"></a>Half-<span class="math inline">\(t\)</span> prior on <span class="math inline">\(\sigma\)</span>
</h2>
<p>The optimal density for <span class="math inline">\(\beta\)</span> is unchanged from the previous section.</p>
</div>
</div>
<div id="t-linear-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#t-linear-regression" class="anchor"></a><span class="math inline">\(t\)</span> Linear Regression</h1>
<p><span class="citation">(Wand et al. 2010)</span></p>
<p>We replace <span class="math inline">\(p(y|\beta,\sigma^2) = \text{Normal}(y|X\beta, \Sigma)\)</span> by <span class="math display">\[
\begin{aligned}
p(y_i|\beta,\sigma,\nu) &amp;= \text{Student-t}(x_i^\top\beta, \sigma, \nu) \\
p(\nu) &amp;= \text{Uniform}(\nu_0, \nu_1)
\end{aligned}
\]</span> which is equivalent to <span class="math display">\[
\begin{aligned}
p(y_i|\beta,\sigma,\nu) &amp;= \text{Normal}(x_i^\top\beta, \lambda_i\sigma^2) \\
p(\lambda_i|\nu) &amp;= \text{Inverse-Gamma}(\nu/2, \nu/2) \\
p(\nu) &amp;= \text{Uniform}(\nu_0, \nu_1).
\end{aligned}
\]</span></p>
<p>Assuming an inverse-gamma prior on <span class="math inline">\(\sigma^2\)</span>, the full-conditionals satisfy <span class="math display">\[
\begin{aligned}
\ln p(\beta|y,\sigma^2,\nu,\lambda) &amp;= \text{const} \\
\ln p(\sigma^2|y,\beta,\nu,\lambda) &amp;= \text{const} -(a_0+n/2)\ln(\sigma^2) - \left[b_0+\frac{1}{2}\left((y-X\beta)^\top \text{diag}(1/\lambda)(y - X\beta)\right)\right]/\sigma^2 \\
\ln p(\lambda_i|y,\beta,\nu,\sigma^2) &amp;= \text{const} + \sum_{i=1}^n\left[ -\frac{1}{2}(\nu + 1)\ln(\lambda_i) - \frac{1}{2}\left[\nu + \sigma^{-2}(y_i-x_i^\top\beta)^2\right]/\lambda_i\right] \\
\ln p(\nu|y,\beta,\sigma^2,\lambda) &amp;= \text{const} + n\left[\frac{\nu}{2}\ln(\nu/2)-\ln\Gamma(\nu/2)\right]-(\nu/2)1^\top(\ln\lambda+1/\lambda),\quad\nu_0&lt;\nu&lt;\nu_1
\end{aligned}
\]</span></p>
<p>We use the factorisation <span class="math inline">\(q(\beta,\nu,\sigma^2,\lambda)=q(\beta,\nu)q(\sigma^2)q(\lambda)\)</span> which, from the form of the full-conditionals above, results in <span class="math display">\[
\begin{aligned}
q^\star(\beta) &amp;= \text{Normal}(\mu_{q(\beta)}, \Sigma_{q(\beta)}) \\
q^\star(\sigma^2) &amp;= \text{Inverse-Gamma}(a_{q(\sigma^2)}, b_{q(\sigma^2)}) \\
q^\star(\lambda_i) &amp;= \text{Inverse-Gamma}(a_{q(\lambda_i)}, b_{q(\lambda_i)}) \\
q^\star(\nu) &amp;= \frac{\exp\left\{n\left[\frac{\nu}{2}\ln(\nu/2)-\ln\Gamma(\nu/2)\right]-(\nu/2)C_\nu\right\}}{\mathcal{F}(0,n,C_\nu,\nu_0,\nu_1)} \\
C_\nu &amp;= \sum_{i=1}^n \mathbb E[\ln\lambda_i] + \mathbb E[\lambda_i^{-1}] \\
&amp;= \sum_{i=1}^n \ln(b_{q(\lambda_i)}) - \psi\left(\frac{1}{2}(\mathbb \mu_{q(\nu)}+1)\right) + \frac{a_{q(\lambda_i)}}{b_{q(\lambda_i)}} \\
\mu_{q(\nu)} &amp;= \frac{\mathcal{F}(1,n,C_\nu,\nu_0,\nu_1)}{\mathcal{F}(0,n,C_\nu,\nu_0,\nu_1)} \\
a_{q(\lambda_i)} &amp;= \frac{\mu_{q(\nu)} + 1}{2}\\
b_{q(\lambda_i)} &amp;= \frac{1}{2}\left[\mu_{q(\nu)} + \frac{a_{q(\sigma^2)}}{b_{q(\sigma^2)}}\left\{(y-X\mu_{q(\beta)})_i^2 + (X\Sigma_{q(\beta)}X^\top)_{ii}\right\}\right] \\
D_\lambda &amp;= \text{diag}(a_{q(\lambda_i)}/b_{q(\lambda_i)}) \\
a_{q(\sigma^2)} &amp;= a_0 + n/2\\
b_{q(\sigma^2)} &amp;= b_0 + \frac{1}{2}\left[(y-X\mu_{q(\beta)})^\top D_\lambda(y-X\mu_{q(\beta)})+\text{tr}(\Sigma_{q(\beta)}X^\top D_\lambda X)\right]\\
\Sigma_{q(\beta)} &amp;= \left(\frac{a_{q(\sigma^2)}}{b_{q(\sigma^2)}}X^\top D_\lambda X + \Sigma_0^{-1}\right)^{-1}\\
\mu_{q(\beta)} &amp;= \Sigma_{q(\beta)}\left(\frac{a_{q(\sigma^2)}}{b_{q(\sigma^2)}}X^\top D_\lambda y + \Sigma_0^{-1}\mu_0\right).
\end{aligned}
\]</span></p>
<p>The ELBO is then <span class="math display">\[
\begin{aligned}
\mathcal{L}(q) &amp;= \mathbb E[\ln p(y,\beta,\sigma^2,\lambda,\nu) - \ln q(\beta,\sigma^2,\lambda,\nu)] \\
&amp;=
\end{aligned}
\]</span></p>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-wand2010">
<p>Wand, Matt, JT Ormerod, SA Padoan, and R Fruhwirth. 2010. “Variational Bayes for Elaborate Distributions.”</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by James Totterdell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
